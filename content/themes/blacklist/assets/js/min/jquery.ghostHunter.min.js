!function(t){var e,i,n,o,r,s,a,l,h,u,c=function(t){var e=new c.Index;return e.pipeline.add(c.stopWordFilter,c.stemmer),t&&t.call(e,e),e};c.version="0.4.3","undefined"!=typeof module&&(module.exports=c),c.utils={},c.utils.warn=(u=this,function(t){u.console&&console.warn&&console.warn(t)}),c.utils.zeroFillArray=(h=[0],function(t){for(;t>h.length;)h=h.concat(h);return h.slice(0,t)}),c.EventEmitter=function(){this.events={}},c.EventEmitter.prototype.addListener=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),i=t;if("function"!=typeof e)throw new TypeError("last argument must be a function");i.forEach(function(t){this.hasHandler(t)||(this.events[t]=[]),this.events[t].push(e)},this)},c.EventEmitter.prototype.removeListener=function(t,e){if(this.hasHandler(t)){var i=this.events[t].indexOf(e);this.events[t].splice(i,1),this.events[t].length||delete this.events[t]}},c.EventEmitter.prototype.emit=function(t){if(this.hasHandler(t)){var e=Array.prototype.slice.call(arguments,1);this.events[t].forEach(function(t){t.apply(void 0,e)})}},c.EventEmitter.prototype.hasHandler=function(t){return t in this.events},c.tokenizer=function(t){if(!arguments.length||null==t||void 0==t)return[];if(Array.isArray(t))return t.map(function(t){return t.toLowerCase()});for(var e=(""+t).replace(/^\s+/,""),i=e.length-1;i>=0;i--)if(/\S/.test(e.charAt(i))){e=e.substring(0,i+1);break}return e.split(/\s+/).map(function(t){return t.replace(/^\W+/,"").replace(/\W+$/,"").toLowerCase()})},c.Pipeline=function(){this._stack=[]},c.Pipeline.registeredFunctions={},c.Pipeline.registerFunction=function(t,e){e in this.registeredFunctions&&c.utils.warn("Overwriting existing registered function: "+e),t.label=e,c.Pipeline.registeredFunctions[t.label]=t},c.Pipeline.warnIfFunctionNotRegistered=function(t){t.label&&t.label in this.registeredFunctions||c.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",t)},c.Pipeline.load=function(t){var e=new c.Pipeline;return t.forEach(function(t){var i=c.Pipeline.registeredFunctions[t];if(!i)throw Error("Cannot load un-registered function: "+t);e.add(i)}),e},c.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(t){c.Pipeline.warnIfFunctionNotRegistered(t),this._stack.push(t)},this)},c.Pipeline.prototype.after=function(t,e){c.Pipeline.warnIfFunctionNotRegistered(e);var i=this._stack.indexOf(t)+1;this._stack.splice(i,0,e)},c.Pipeline.prototype.before=function(t,e){c.Pipeline.warnIfFunctionNotRegistered(e);var i=this._stack.indexOf(t);this._stack.splice(i,0,e)},c.Pipeline.prototype.remove=function(t){var e=this._stack.indexOf(t);this._stack.splice(e,1)},c.Pipeline.prototype.run=function(t){for(var e=[],i=t.length,n=this._stack.length,o=0;i>o;o++){for(var r=t[o],s=0;n>s&&void 0!==(r=this._stack[s](r,o,t));s++);void 0!==r&&e.push(r)}return e},c.Pipeline.prototype.toJSON=function(){return this._stack.map(function(t){return c.Pipeline.warnIfFunctionNotRegistered(t),t.label})},c.Vector=function(t){this.elements=t},c.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var t,e=0,i=this.elements,n=i.length,o=0;n>o;o++)t=i[o],e+=t*t;return this._magnitude=Math.sqrt(e)},c.Vector.prototype.dot=function(t){for(var e=this.elements,i=t.elements,n=e.length,o=0,r=0;n>r;r++)o+=e[r]*i[r];return o},c.Vector.prototype.similarity=function(t){return this.dot(t)/(this.magnitude()*t.magnitude())},c.Vector.prototype.toArray=function(){return this.elements},c.SortedSet=function(){this.length=0,this.elements=[]},c.SortedSet.load=function(t){var e=new this;return e.elements=t,e.length=t.length,e},c.SortedSet.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(t){~this.indexOf(t)||this.elements.splice(this.locationFor(t),0,t)},this),this.length=this.elements.length},c.SortedSet.prototype.toArray=function(){return this.elements.slice()},c.SortedSet.prototype.map=function(t,e){return this.elements.map(t,e)},c.SortedSet.prototype.forEach=function(t,e){return this.elements.forEach(t,e)},c.SortedSet.prototype.indexOf=function(t,e,i){e=e||0;var n=(i=i||this.elements.length)-e,o=e+Math.floor(n/2),r=this.elements[o];return 1>=n?r===t?o:-1:t>r?this.indexOf(t,o,i):r>t?this.indexOf(t,e,o):r===t?o:void 0},c.SortedSet.prototype.locationFor=function(t,e,i){e=e||0;var n=(i=i||this.elements.length)-e,o=e+Math.floor(n/2),r=this.elements[o];if(1>=n){if(r>t)return o;if(t>r)return o+1}return t>r?this.locationFor(t,o,i):r>t?this.locationFor(t,e,o):void 0},c.SortedSet.prototype.intersect=function(t){for(var e=new c.SortedSet,i=0,n=0,o=this.length,r=t.length,s=this.elements,a=t.elements;!(i>o-1||n>r-1);)s[i]!==a[n]?s[i]<a[n]?i++:s[i]>a[n]&&n++:(e.add(s[i]),i++,n++);return e},c.SortedSet.prototype.clone=function(){var t=new c.SortedSet;return t.elements=this.toArray(),t.length=t.elements.length,t},c.SortedSet.prototype.union=function(t){var e,i,n;return this.length>=t.length?(e=this,i=t):(e=t,i=this),(n=e.clone()).add.apply(n,i.toArray()),n},c.SortedSet.prototype.toJSON=function(){return this.toArray()},c.Index=function(){this._fields=[],this._ref="id",this.pipeline=new c.Pipeline,this.documentStore=new c.Store,this.tokenStore=new c.TokenStore,this.corpusTokens=new c.SortedSet,this.eventEmitter=new c.EventEmitter,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},c.Index.prototype.on=function(){var t=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,t)},c.Index.prototype.off=function(t,e){return this.eventEmitter.removeListener(t,e)},c.Index.load=function(t){t.version!==c.version&&c.utils.warn("version mismatch: current "+c.version+" importing "+t.version);var e=new this;return e._fields=t.fields,e._ref=t.ref,e.documentStore=c.Store.load(t.documentStore),e.tokenStore=c.TokenStore.load(t.tokenStore),e.corpusTokens=c.SortedSet.load(t.corpusTokens),e.pipeline=c.Pipeline.load(t.pipeline),e},c.Index.prototype.field=function(t,e){var i={name:t,boost:(e=e||{}).boost||1};return this._fields.push(i),this},c.Index.prototype.ref=function(t){return this._ref=t,this},c.Index.prototype.add=function(t,e){var i={},n=new c.SortedSet,o=t[this._ref];e=void 0===e||e;this._fields.forEach(function(e){var o=this.pipeline.run(c.tokenizer(t[e.name]));i[e.name]=o,c.SortedSet.prototype.add.apply(n,o)},this),this.documentStore.set(o,n),c.SortedSet.prototype.add.apply(this.corpusTokens,n.toArray());for(var r=0;n.length>r;r++){var s=n.elements[r],a=this._fields.reduce(function(t,e){var n=i[e.name].length;return n?t+i[e.name].filter(function(t){return t===s}).length/n*e.boost:t},0);this.tokenStore.add(s,{ref:o,tf:a})}e&&this.eventEmitter.emit("add",t,this)},c.Index.prototype.remove=function(t,e){var i=t[this._ref];e=void 0===e||e;if(this.documentStore.has(i)){var n=this.documentStore.get(i);this.documentStore.remove(i),n.forEach(function(t){this.tokenStore.remove(t,i)},this),e&&this.eventEmitter.emit("remove",t,this)}},c.Index.prototype.update=function(t,e){e=void 0===e||e;this.remove(t,!1),this.add(t,!1),e&&this.eventEmitter.emit("update",t,this)},c.Index.prototype.idf=function(t){if(this._idfCache[t])return this._idfCache[t];var e=this.tokenStore.count(t),i=1;return e>0&&(i=1+Math.log(this.tokenStore.length/e)),this._idfCache[t]=i},c.Index.prototype.search=function(t){var e=this.pipeline.run(c.tokenizer(t)),i=c.utils.zeroFillArray(this.corpusTokens.length),n=[],o=this._fields.reduce(function(t,e){return t+e.boost},0);if(!e.some(function(t){return this.tokenStore.has(t)},this))return[];e.forEach(function(t,e,r){var s=1/r.length*this._fields.length*o,a=this,l=this.tokenStore.expand(t).reduce(function(e,n){var o=a.corpusTokens.indexOf(n),r=a.idf(n),l=1,h=new c.SortedSet;if(n!==t){var u=Math.max(3,n.length-t.length);l=1/Math.log(u)}return o>-1&&(i[o]=s*r*l),Object.keys(a.tokenStore.get(n)).forEach(function(t){h.add(t)}),e.union(h)},new c.SortedSet);n.push(l)},this);var r=n.reduce(function(t,e){return t.intersect(e)}),s=new c.Vector(i);return r.map(function(t){return{ref:t,score:s.similarity(this.documentVector(t))}},this).sort(function(t,e){return e.score-t.score})},c.Index.prototype.documentVector=function(t){for(var e=this.documentStore.get(t),i=e.length,n=c.utils.zeroFillArray(this.corpusTokens.length),o=0;i>o;o++){var r=e.elements[o],s=this.tokenStore.get(r)[t].tf,a=this.idf(r);n[this.corpusTokens.indexOf(r)]=s*a}return new c.Vector(n)},c.Index.prototype.toJSON=function(){return{version:c.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},c.Store=function(){this.store={},this.length=0},c.Store.load=function(t){var e=new this;return e.length=t.length,e.store=Object.keys(t.store).reduce(function(e,i){return e[i]=c.SortedSet.load(t.store[i]),e},{}),e},c.Store.prototype.set=function(t,e){this.store[t]=e,this.length=Object.keys(this.store).length},c.Store.prototype.get=function(t){return this.store[t]},c.Store.prototype.has=function(t){return t in this.store},c.Store.prototype.remove=function(t){this.has(t)&&(delete this.store[t],this.length--)},c.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},c.stemmer=(e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},i={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},s="^("+(o="[^aeiou][^aeiouy]*")+")?"+(r=(n="[aeiouy]")+"[aeiou]*")+o,a="^("+o+")?"+r+o+r+o,l="^("+o+")?"+n,function(t){var r,h,u,c,p,f,d;if(3>t.length)return t;if("y"==(u=t.substr(0,1))&&(t=u.toUpperCase()+t.substr(1)),p=/^(.+?)([^s])s$/,(c=/^(.+?)(ss|i)es$/).test(t)?t=t.replace(c,"$1$2"):p.test(t)&&(t=t.replace(p,"$1$2")),p=/^(.+?)(ed|ing)$/,(c=/^(.+?)eed$/).test(t)){var m=c.exec(t);(c=RegExp(s)).test(m[1])&&(c=/.$/,t=t.replace(c,""))}else p.test(t)&&(r=(m=p.exec(t))[1],(p=RegExp(l)).test(r)&&(t=r,p=/(at|bl|iz)$/,f=RegExp("([^aeiouylsz])\\1$"),d=RegExp("^"+o+n+"[^aeiouwxy]$"),p.test(t)?t+="e":f.test(t)?(c=/.$/,t=t.replace(c,"")):d.test(t)&&(t+="e")));return(c=/^(.+?)y$/).test(t)&&(r=(m=c.exec(t))[1],(c=RegExp(l)).test(r)&&(t=r+"i")),(c=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(t)&&(r=(m=c.exec(t))[1],h=m[2],(c=RegExp(s)).test(r)&&(t=r+e[h])),(c=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(t)&&(r=(m=c.exec(t))[1],h=m[2],(c=RegExp(s)).test(r)&&(t=r+i[h])),p=/^(.+?)(s|t)(ion)$/,(c=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(t)?(r=(m=c.exec(t))[1],(c=RegExp(a)).test(r)&&(t=r)):p.test(t)&&(r=(m=p.exec(t))[1]+m[2],(p=RegExp(a)).test(r)&&(t=r)),(c=/^(.+?)e$/).test(t)&&(r=(m=c.exec(t))[1],c=RegExp(a),p=RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$"),f=RegExp("^"+o+n+"[^aeiouwxy]$"),(c.test(r)||p.test(r)&&!f.test(r))&&(t=r)),c=/ll$/,p=RegExp(a),c.test(t)&&p.test(t)&&(c=/.$/,t=t.replace(c,"")),"y"==u&&(t=u.toLowerCase()+t.substr(1)),t}),c.Pipeline.registerFunction(c.stemmer,"stemmer"),c.stopWordFilter=function(t){return-1===c.stopWordFilter.stopWords.indexOf(t)?t:void 0},c.stopWordFilter.stopWords=new c.SortedSet,c.stopWordFilter.stopWords.length=119,c.stopWordFilter.stopWords.elements=["","a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],c.Pipeline.registerFunction(c.stopWordFilter,"stopWordFilter"),c.TokenStore=function(){this.root={docs:{}},this.length=0},c.TokenStore.load=function(t){var e=new this;return e.root=t.root,e.length=t.length,e},c.TokenStore.prototype.add=function(t,e,i){i=i||this.root;var n=t[0],o=t.slice(1);return n in i||(i[n]={docs:{}}),0===o.length?(i[n].docs[e.ref]=e,void(this.length+=1)):this.add(o,e,i[n])},c.TokenStore.prototype.has=function(t){if(!t)return!1;for(var e=this.root,i=0;t.length>i;i++){if(!e[t[i]])return!1;e=e[t[i]]}return!0},c.TokenStore.prototype.getNode=function(t){if(!t)return{};for(var e=this.root,i=0;t.length>i;i++){if(!e[t[i]])return{};e=e[t[i]]}return e},c.TokenStore.prototype.get=function(t,e){return this.getNode(t,e).docs||{}},c.TokenStore.prototype.count=function(t,e){return Object.keys(this.get(t,e)).length},c.TokenStore.prototype.remove=function(t,e){if(t){for(var i=this.root,n=0;t.length>n;n++){if(!(t[n]in i))return;i=i[t[n]]}delete i.docs[e]}},c.TokenStore.prototype.expand=function(t,e){var i=this.getNode(t),n=i.docs||{};e=e||[];return Object.keys(n).length&&e.push(t),Object.keys(i).forEach(function(i){"docs"!==i&&e.concat(this.expand(t+i,e))},this),e},c.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},t.fn.ghostHunter=function(e){var i=t.extend({},t.fn.ghostHunter.defaults,e);if(i.results)return p.init(this,i),p},t.fn.ghostHunter.defaults={results:!1,rss:"/assets/output.xml",onKeyUp:!1,result_template:"<a href='{{link}}'><p><h2>{{title}}</h2><h4>{{pubDate}}</h4></p></a>",info_template:"<p>Number of posts found: {{amount}}</p>",displaySearchInfo:!0,zeroResultsInfo:!0,before:!1,onComplete:!1};var p={isInit:!1,init:function(t,e){var i=this;this.target=t,this.rss=e.rss,this.results=e.results,this.blogData=[],this.result_template=e.result_template,this.info_template=e.info_template,this.zeroResultsInfo=e.zeroResultsInfo,this.displaySearchInfo=e.displaySearchInfo,this.before=e.before,this.onComplete=e.onComplete,this.index=c(function(){this.field("title",{boost:10}),this.field("description"),this.field("link"),this.field("category"),this.field("pubDate"),this.ref("id")}),t.focus(function(){i.loadRSS()}),t.closest("form").submit(function(e){e.preventDefault(),i.find(t.val())}),e.onKeyUp&&(i.loadRSS(),t.keyup(function(){i.find(t.val())}))},loadRSS:function(){if(this.isInit)return!1;var e=this.index,i=this.rss,n=this.blogData;t.get(i,function(i){for(var o=t(i).find("item"),r=0;o&&r<o.length;r++){var s=o.eq(r),a={id:r+1,title:s.find("title").text(),description:s.find("description").text(),category:s.find("category").text(),pubDate:s.find("pubDate").text(),link:s.find("link").text()};e.add(a),n.push(a)}}),this.isInit=!0},find:function(e){var i=this.index.search(e),n=t(this.results),o=[];n.empty(),this.before&&this.before(),(this.zeroResultsInfo||i.length>0)&&this.displaySearchInfo&&n.append(this.format(this.info_template,{amount:i.length}));for(var r=0;r<i.length;r++){var s=this.blogData[i[r].ref-1];n.append(this.format(this.result_template,s)),o.push(s)}this.onComplete&&this.onComplete(o)},clear:function(){t(this.results).empty(),this.target.val("")},format:function(t,e){return t.replace(/{{([^{}]*)}}/g,function(t,i){var n=e[i];return"string"==typeof n||"number"==typeof n?n:t})}}}(jQuery);
